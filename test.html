<!DOCTYPE html>
<html>
<head>
    <title>Panic Button Test</title>
    <style>
        #panic-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 16px;
            background-color: #dc3545;
            color: white;
            font-size: 18px;
            font-weight: bold;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            transition: background-color 0.2s;
            z-index: 1000;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }

        @keyframes flash {
            0%, 100% {
                background-color: #dc3545;
                box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
            }
            50% {
                background-color: #ff6b7a;
                box-shadow: 0 0 20px rgba(220, 53, 69, 0.8);
            }
        }
    </style>
</head>
<body>
    <h1>Panic Button Test</h1>
    <button id="panic-button" onclick="testPanic()">🚨 PANIC</button>    <script>
        // Simulate the same environment as map.js
        let recentReports = [];
        
        function getReportEmoji(type) {
            switch(type) {
                case 'crime': return '⚠️';
                case 'lighting': return '🔦';
                case 'pothole': return '🕳️';
                case 'safe': return '✅';
                case 'panic': return '🚨';
                default: return '📍';
            }
        }
        
        function updateReportsTable() {
            console.log('updateReportsTable called, reports:', recentReports);
            // Simulate the function (we don't have the table in this test)
        }
        
        function createOrUpdateDangerZone(lat, lon, type, location) {
            console.log('createOrUpdateDangerZone called:', lat, lon, type, location);
            // Simulate the function
        }

        function testPanic() {
            console.log('Panic button clicked!');
            
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition((position) => {
                    const { latitude, longitude } = position.coords;
                    const location = `${latitude.toFixed(6)}, ${longitude.toFixed(6)}`;
                    const time = new Date().toLocaleString();
                    
                    // Add panic report to recent reports
                    recentReports.unshift({ 
                        type: 'panic', 
                        location: location, 
                        time: time 
                    });
                    if (recentReports.length > 10) recentReports.pop();
                    
                    // Create an urgent danger zone for panic reports
                    createOrUpdateDangerZone(latitude, longitude, 'crime', location);
                    
                    // Update the reports table
                    updateReportsTable();
                    
                    // Show urgent alert with emergency options
                    const emergencyActions = confirm(
                        `🚨 PANIC ALERT ACTIVATED! 🚨\n\n` +
                        `Your location has been logged: ${location}\n` +
                        `Time: ${time}\n\n` +
                        `Emergency services recommended!\n\n` +
                        `Click OK to get emergency numbers, or Cancel to close this alert.`
                    );
                    
                    if (emergencyActions) {
                        alert(
                            `🚨 EMERGENCY CONTACTS 🚨\n\n` +
                            `🚓 Police: 10111\n` +
                            `🚑 Ambulance: 10177\n` +
                            `🔥 Fire Department: 10111\n` +
                            `📞 Private Security: 10111\n\n` +
                            `Your panic location has been recorded for safety tracking.`
                        );
                    }
                    
                    // Flash the panic button to show it was activated
                    const panicButton = document.getElementById('panic-button');
                    if (panicButton) {
                        panicButton.style.animation = 'flash 1s ease-in-out 3';
                        setTimeout(() => {
                            panicButton.style.animation = '';
                        }, 3000);
                    }
                    
                }, (error) => {
                    // If location access fails, still allow panic report
                    const time = new Date().toLocaleString();
                    
                    recentReports.unshift({ 
                        type: 'panic', 
                        location: 'Location unavailable', 
                        time: time 
                    });
                    if (recentReports.length > 10) recentReports.pop();
                    
                    updateReportsTable();
                    
                    alert(
                        `🚨 PANIC ALERT ACTIVATED! 🚨\n\n` +
                        `Time: ${time}\n` +
                        `Location: Could not determine (enable location services for better tracking)\n\n` +
                        `🚓 Police: 10111\n` +
                        `🚑 Ambulance: 10177\n` +
                        `🔥 Fire Department: 10111`
                    );
                });
            } else {
                // Geolocation not supported
                const time = new Date().toLocaleString();
                
                recentReports.unshift({ 
                    type: 'panic', 
                    location: 'Location unavailable', 
                    time: time 
                });
                if (recentReports.length > 10) recentReports.pop();
                
                updateReportsTable();
                
                alert(
                    `🚨 PANIC ALERT ACTIVATED! 🚨\n\n` +
                    `Time: ${time}\n` +
                    `Location: Browser does not support location services\n\n` +
                    `🚓 Police: 10111\n` +
                    `🚑 Ambulance: 10177\n` +
                    `🔥 Fire Department: 10111`
                );
            }
        }
    </script>
</body>
</html>
